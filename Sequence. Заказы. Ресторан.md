@startuml
title Заказы. Со стороны ресторана\nдиаграмма прецедентов
actor Ресторан as Ресторан
actor  Яндекс.Маршрутизация as Яндекс.Маршрутизация
boundary Frontend as Frontend 
[o-> MS_Заказы: статус оплаты
MS_Заказы -> MS_Заказы : проверить статус оплаты
alt оплата прошла успешно
MS_Заказы -> Frontend : новый заказ (данные)
Frontend -> Ресторан: отобразить новый заказ
end
Ресторан -> Ресторан : мы можем приготовить заказ?
alt да
Ресторан -> Frontend : принять заказ
Frontend -> MS_Заказы: заказ (id) принят
MS_Заказы -> MS_Доставка : заказ (id) "В работе"
else нет
note over Ресторан, Frontend
Ресторан просто не принимает заказ
В системе ничего не происходит, ожидание
end note
else заказ не принят в течение 2-х минут
note over Ресторан, Frontend
1. ресторан не может приготовить заказ
2. ресторан не успевает принять заказ
end note
MS_Заказы -> MS_Уведомления : запрос на звонок (данные)
MS_Уведомления -> Ресторан: звонок от робота на телефон ресторана
...прошло x минут...

alt ресторан принимает заказ
Ресторан -> Frontend : принять заказ
Frontend -> MS_Заказы: заказ (id) принят
MS_Заказы -> MS_Доставка : заказ (id) "В работе"

else ресторан не принимает заказ
MS_Заказы -> Frontend : заказ (id) отменен
Frontend -> Ресторан : скрыть отмененный заказ
end
end
alt доставка курьерами Яндекс.Еда
MS_Доставка -> MS_Заказы: заказ (id) принят курьером (id)
MS_Заказы -> Frontend : заказ (id) принят курьером (данные)
Frontend -> Ресторан : отобразить id, телефон курьера
MS_Заказы -> Яндекс.Маршрутизация : запрос местоположения курьера (id)
Яндекс.Маршрутизация --> Frontend : данные местоположения курьера (id) 
Frontend -> Ресторан : отобразить местоположение курьера
opt заказ просрочен
Frontend -> Frontend : событие заказ не готов \nпо истечении установленного \nвремени
Frontend -> Ресторан : отобразить заказ (id) просрочен
end
Ресторан -> Frontend : заказ готов 
Frontend -> MS_Заказы: изменить статус заказа (id) 
MS_Заказы -> MS_Доставка : заказ (id) "Готов к отправке"
note over Frontend, MS_Заказы
Передачу заказа курьеру см. в диаграмме Доставка курьерами Яндекс.Еда
end note
...ожидание доставки заказа...
MS_Доставка -> MS_Заказы : заказ (id), код доставки (id)
MS_Заказы -> Frontend : заказ (id) доставлен
Frontend -> Ресторан : заказ (id) статус "Будет оплачен"
else доставка ресторана
Ресторан -> Frontend : Передать курьеру
Frontend -> MS_Заказы : заказ (id) передан курьеру
MS_Заказы -> MS_Заказы : заказ (id) "В доставке"
...ожидание фактической доставки...
Ресторан -> Frontend : Доставлено
Frontend -> MS_Заказы : заказ (id) доставлен
MS_Заказы -> MS_Заказы : заказ (id) завершен 
end
@enduml